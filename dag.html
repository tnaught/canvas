<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
</head>
<body>
  <script type="text/javascript">
    var links = []//input
    var o_refNodes = Object.create(null), a_refNodes = []
    var a_rootNodes = []

    //示例
    links = [
      {input: {id: 1, name: 'A'}, output: {id: 2, name: 'B'}},
      {input: {id: 2, name: 'B'}, output: {id: 3, name: 'C'}},
      {input: {id: 2, name: 'B'}, output: {id: 4, name: 'D'}},
      {input: {id: 3, name: 'C'}, output: {id: 5, name: 'E'}},
      {input: {id: 4, name: 'D'}, output: {id: 3, name: 'C'}}
    ];

    links.forEach(function(link) {
      if (!o_refNodes[link.output.id]) {
        o_refNodes[link.output.id] = link.output
      }
      if (!o_refNodes[link.input.id]) {
        o_refNodes[link.input.id] = link.input
      }
      o_refNodes[link.output.id].isRoot = false
      
      if (o_refNodes[link.input.id] && o_refNodes[link.input.id].isRoot !== false) {
        a_rootNodes.push(link.input.id)
      }
      
      if (a_rootNodes.indexOf(link.output.id) > -1) {
        a_rootNodes.splice(a_rootNodes.indexOf(link.output.id), 1)
      }
    })

    for(var node in o_refNodes) {
      a_refNodes.push(o_refNodes[node])
    }
    
var nodeLevel = {};
  function setNodeMaxStep(){
    var len=a_refNodes.length;
    for(var i=0;i<len;i++){
        var search_node=a_refNodes[i];  //每次需要判定最大步长的节点

        //每次从根节点开始查找
        for(var k=0;k<a_rootNodes.length;k++){
            var root_node=a_rootNodes[k];    //获取当前根节点
            var node_arr=new Array();   //存放依次遍历的同级节点,首次放入根节点,逐步查找下一级别
            node_arr.push(root_node);

            var stepCount=1;    //从根节点级别时步长计数器归零

            //设置根节点的级别,根节点的步长为零
            nodeLevel[root_node]={};
            nodeLevel[root_node].breadth=stepCount;

            //递归查找search_node的最大步长
            recordNodeStep(node_arr,search_node,stepCount);

        }

    }
}

function recordNodeStep(arr,search_node,stepCount){
    if(arr!=null && arr!=undefined && arr.length>0){

        var temp_node_arr=new Array();  //临时存储下一级别节点的数组
        stepCount++;    //逐级增加步长,级别的判定就是arr数组的出现频次
        for(var n=0;n<arr.length;n++){
            var temp_node=arr[n];   //作为输出节点去查找输入点(即查找下一级节点)
            links.forEach(function(link,l){
                var in_node=link.input.id;
                var out_node=link.output.id;
                if(temp_node==in_node){    //查找到输入点

                    if(temp_node_arr.indexOf(out_node)==-1){
                        temp_node_arr.push(out_node);
                    }
                    //节点作为输出点时找到对应的输入点,若输入点等于需要判定步长的节点怎记录步长信息
                    if(out_node==search_node.id){  //找到当前节点则记录当前步长
                        if(nodeLevel[out_node]==undefined){
                            nodeLevel[out_node]={};
                        }
                        //考虑到被判定步长的节点有可能存在多个根节点的关系链中且每次切换根节点计算步长都会将步长计数器归零,因此需要保留最大步长数
                        // if(nodeLevel[out_node].breadth!=undefined && nodeLevel[out_node].breadth!=null){
                        //     var last_breadth=nodeLevel[out_node].breadth;
                        //     if(stepCount>last_breadth){
                        //         nodeLevel[out_node].breadth=stepCount;
                        //     }
                        // }else{
                        //     nodeLevel[out_node].breadth=stepCount;
                        // }
                    }
                }
            });
        }
        arr=temp_node_arr;
        recordNodeStep(arr,search_node,stepCount);


    }
}

setNodeMaxStep()

console.log(nodeLevel)

function setNodesDeepth(){
    var deepthLevel={};
    for(var i in nodeLevel) {
      var node = nodeLevel[i]
      var breadth=node.breadth;
        if(deepthLevel[breadth]==undefined && deepthLevel[breadth]==null){
            deepthLevel[breadth]=0;
        }
    }

    console.log(deepthLevel)
    for(var i in nodeLevel) {
      var node = nodeLevel[i]
        var breadth=node.breadth;
        deepthLevel[breadth]+=1;
        node.deepth=deepthLevel[breadth];
    };


}

setNodesDeepth()

console.log(nodeLevel)
  </script>
</body>
</html>